<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ja class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.100.2"><link rel=alternate type=application/rss+xml href=https://tsubasaxzzz.github.io/fta-hackon2022/ja/docs/advanced/index.xml><meta name=robots content="index, follow"><link rel="shortcut icon" href=/fta-hackon2022/favicons/favicon.ico><link rel=apple-touch-icon href=/fta-hackon2022/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/fta-hackon2022/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/fta-hackon2022/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/fta-hackon2022/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/fta-hackon2022/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/fta-hackon2022/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/fta-hackon2022/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/fta-hackon2022/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/fta-hackon2022/favicons/android-192x192.png sizes=192x192><title>å¿œç”¨ç·¨ | KUSTO 100+ knocks</title><meta name=description content="Azure ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‚’å­¦ç¿’ã—ã¾ã™ã€‚"><meta property="og:title" content="å¿œç”¨ç·¨"><meta property="og:description" content="Azure ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‚’å­¦ç¿’ã—ã¾ã™ã€‚"><meta property="og:type" content="website"><meta property="og:url" content="https://tsubasaxzzz.github.io/fta-hackon2022/ja/docs/advanced/"><meta itemprop=name content="å¿œç”¨ç·¨"><meta itemprop=description content="Azure ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‚’å­¦ç¿’ã—ã¾ã™ã€‚"><meta name=twitter:card content="summary"><meta name=twitter:title content="å¿œç”¨ç·¨"><meta name=twitter:description content="Azure ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‚’å­¦ç¿’ã—ã¾ã™ã€‚"><link rel=preload href=/fta-hackon2022/scss/main.min.e42fbc313eb1919891fde4bb3bfbacc710b8890c78adce84a179ab0f4ff8977d.css as=style><link href=/fta-hackon2022/scss/main.min.e42fbc313eb1919891fde4bb3bfbacc710b8890c78adce84a179ab0f4ff8977d.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/fta-hackon2022/ja/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=font-weight-bold>KUSTO 100+ knocks</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/fta-hackon2022/ja/docs/><span class=active>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>æ—¥æœ¬èª</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/fta-hackon2022/docs/advanced/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>æ—¥æœ¬èª</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/fta-hackon2022/docs/advanced/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-fta-hackon2022jadocs-li><a href=/fta-hackon2022/ja/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-fta-hackon2022jadocs><span>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-fta-hackon2022jadocsbasic-li><a href=/fta-hackon2022/ja/docs/basic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-fta-hackon2022jadocsbasic><span>åŸºæœ¬ç·¨</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-fta-hackon2022jadocsadvanced-li><a href=/fta-hackon2022/ja/docs/advanced/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__section" id=m-fta-hackon2022jadocsadvanced><span class=td-sidebar-nav-active-item>å¿œç”¨ç·¨</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-fta-hackon2022jadocsportal-li><a href=https://portal.azure.com/#blade/Microsoft_Azure_Monitoring_Logs/DemoLogsBlade target=_blank rel=noopener class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-fta-hackon2022jadocsportal><span>ãƒ‡ãƒ¢ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã§è©¦ã™ğŸ”</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/tsubasaxZZZ/fta-hackon2022/tree/main/content/ja/docs/Advanced/_index.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/tsubasaxZZZ/fta-hackon2022/edit/main/content/ja/docs/Advanced/_index.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> ãƒšãƒ¼ã‚¸ã®ç·¨é›†</a>
<a href="https://github.com/tsubasaxZZZ/fta-hackon2022/new/main/content/ja/docs/Advanced/_index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> å­ãƒšãƒ¼ã‚¸ã‚’ä½œæˆ</a>
<a href="https://github.com/tsubasaxZZZ/fta-hackon2022/issues/new?title=%e5%bf%9c%e7%94%a8%e7%b7%a8" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®issueã‚’ä½œæˆ</a>
<a href=https://github.com/tsubasaxZZZ/fta-hackon2022/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®issueã‚’ä½œæˆ</a></div><div class=td-toc><nav id=TableOfContents><ul><li><ul><li><a href=#network>Network</a></li><li><a href=#compute>Compute</a></li><li><a href=#data>Data</a></li><li><a href=#avd>AVD</a></li><li><a href=#application-insights>Application Insights</a></li><li><a href=#security>Security</a></li><li><a href=#resource-graph>Resource Graph</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://tsubasaxzzz.github.io/fta-hackon2022/ja/docs/>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></li><li class="breadcrumb-item active" aria-current=page><a href=https://tsubasaxzzz.github.io/fta-hackon2022/ja/docs/advanced/>å¿œç”¨ç·¨</a></li></ol></nav><div class=td-content><h1>å¿œç”¨ç·¨</h1><div class=lead>Azure ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ˆãä½¿ã‚ã‚Œã‚‹ã‚¯ã‚¨ãƒªã‚’å­¦ç¿’ã—ã¾ã™ã€‚</div><header class=article-meta></header><h3 id=network>Network</h3><div><details><summary>ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã«ã‚ˆã£ã¦æ‹’å¦ã•ã‚ŒãŸ Azure ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ«ãƒ¼ãƒ«ã®ç¢ºèª</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>q1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>view</span>() {
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AzureFirewallApplicationRule&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#a6e22e>contains</span> <span style=color:#e6db74>&#34; to &#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span><span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>kind</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>regex</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Protocol</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34; request from &#34;</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>SourcePort</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#a6e22e>TargetURL</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>targetPort</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34;. Action: &#34;</span> <span style=color:#a6e22e>Action</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34;.\sN&#34;</span> <span style=color:#a6e22e>Reason</span>
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>q2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>view</span>() {
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AzureFirewallApplicationRule&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>contains</span> <span style=color:#e6db74>&#34; to &#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span><span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>kind</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>regex</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Protocol</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34; request from &#34;</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>SourcePort</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34;. Action: &#34;</span> <span style=color:#a6e22e>Action</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>&#34;. Reason:&#34;</span> <span style=color:#a6e22e>Reason</span>
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#a6e22e>union</span> <span style=color:#a6e22e>withsource</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;temptable&#34;</span> <span style=color:#a6e22e>q1</span>,<span style=color:#a6e22e>q2</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;xx.xx.xx.xx&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TargetURL</span>, <span style=color:#a6e22e>targetPort</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//#| summarize count() by FQDN | order by count_ desc 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>count_</span> <span style=color:#a6e22e>desc</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã«ã‚ˆã£ã¦æ‹’å¦ã•ã‚ŒãŸ Azure ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ« ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ«ãƒ¼ãƒ«ã®ç¢ºèª</p></details></div><div><details><summary>ç‰¹å®šã® IP ãŠã‚ˆã³ãƒãƒ¼ãƒˆã«å¯¾ã™ã‚‹ Azure ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®æ‹’å¦æ¥ç¶š (ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ«ãƒ¼ãƒ«) ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ (å¿…è¦ã«å¿œã˜ã¦ã‚¯ã‚¨ãƒªã‚’å¤‰æ›´ã™ã‚‹)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AzureFirewallNetworkRule&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Protocol</span> <span style=color:#e6db74>&#34; request from &#34;</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>SourcePortInt</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#a6e22e>TargetIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>TargetPortInt</span><span style=color:#f92672>:</span><span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;. Action: &#34;</span> <span style=color:#a6e22e>Action1a</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;was &#34;</span> <span style=color:#a6e22e>Action1b</span> <span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#a6e22e>NatDestination</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Protocol2</span> <span style=color:#e6db74>&#34; request from &#34;</span> <span style=color:#a6e22e>SourceIP2</span> <span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#a6e22e>TargetIP2</span> <span style=color:#e6db74>&#34;. Action:&#34;</span> <span style=color:#a6e22e>Action2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>SourcePort</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>SourcePortInt</span>),<span style=color:#a6e22e>TargetPort</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>TargetPortInt</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>Action</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>Action1a</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>Action1b</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#a6e22e>Action2</span>,<span style=color:#a6e22e>Action1b</span>), <span style=color:#a6e22e>Action1a</span>),<span style=color:#a6e22e>Protocol</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>Protocol</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>Protocol2</span>, <span style=color:#a6e22e>Protocol</span>),<span style=color:#a6e22e>SourceIP</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>SourceIP</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>SourceIP2</span>, <span style=color:#a6e22e>SourceIP</span>),<span style=color:#a6e22e>TargetIP</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>TargetIP</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>TargetIP2</span>, <span style=color:#a6e22e>TargetIP</span>),<span style=color:#a6e22e>SourcePort</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>SourcePort</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;N/A&#34;</span>, <span style=color:#a6e22e>SourcePort</span>),<span style=color:#a6e22e>TargetPort</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>TargetPort</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;N/A&#34;</span>, <span style=color:#a6e22e>TargetPort</span>),<span style=color:#a6e22e>NatDestination</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>case</span>(<span style=color:#a6e22e>NatDestination</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;N/A&#34;</span>, <span style=color:#a6e22e>NatDestination</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>TimeGenerated</span>,<span style=color:#a6e22e>Protocol</span>, <span style=color:#a6e22e>SourceIP</span>,<span style=color:#a6e22e>SourcePort</span>,<span style=color:#a6e22e>TargetIP</span>,<span style=color:#a6e22e>TargetPort</span>,<span style=color:#a6e22e>Action</span>, <span style=color:#a6e22e>NatDestination</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;10.1.4.25&#34;</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>TargetPort</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>22</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>Action</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Deny&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>desc</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ç‰¹å®šã® IP ãŠã‚ˆã³ãƒãƒ¼ãƒˆã«å¯¾ã™ã‚‹ Azure ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®æ‹’å¦æ¥ç¶š (ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒ«ãƒ¼ãƒ«) ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ (å¿…è¦ã«å¿œã˜ã¦ã‚¯ã‚¨ãƒªã‚’å¤‰æ›´ã™ã‚‹)</p></details></div><div><details><summary>NSG ãƒ•ãƒ­ãƒ¼ãƒ­ã‚° - é€ä¿¡å…ƒ IP ã«åŸºã¥ã„ã¦ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ (å¿…è¦ã«å¿œã˜ã¦ã‚¯ã‚¨ãƒªã‚’å¤‰æ›´ã™ã‚‹)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>  <span style=color:#a6e22e>AzureNetworkAnalytics_CL</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>SubType_s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;FlowLog&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>SrcIP_s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ipaddress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>DestIP_s</span>, <span style=color:#a6e22e>DestPort_d</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>NSG ãƒ•ãƒ­ãƒ¼ãƒ­ã‚° - é€ä¿¡å…ƒ IP(ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤å®›å…ˆãƒãƒ¼ãƒˆãŠã‚ˆã³ IP)ã«åŸºã¥ã„ã¦ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç½®ãæ›ãˆã¾ã™ã€‚</p></details></div><div><details><summary>NSG ãƒ•ãƒ­ãƒ¼ãƒ­ã‚° - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ IP ã«åŸºã¥ã„ã¦ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ (ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ ã‚½ãƒ¼ã‚¹ ãƒãƒ¼ãƒˆã¨ IP)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureNetworkAnalytics_CL</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>SubType_s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;FlowLog&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>DestIP_s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ipaddress&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>SrcIP_s</span>, <span style=color:#a6e22e>DestPort_d</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>NSG ãƒ•ãƒ­ãƒ¼ãƒ­ã‚° - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ IP ã«åŸºã¥ã„ã¦ãƒ•ãƒ­ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ (ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ ã‚½ãƒ¼ã‚¹ ãƒãƒ¼ãƒˆã¨ IP)</p></details></div><div><details><summary>ãƒã‚¤ãƒˆå˜ä½ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®å—ä¿¡ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Computer</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;computername&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesReceived</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ProcessName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>3</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Received</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒã‚¤ãƒˆå˜ä½ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®å—ä¿¡ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€ä¿¡ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Computer</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;computername&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Sent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesSent</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ProcessName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>3</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Sent</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€ä¿¡ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>å—ä¿¡ãƒã‚¤ãƒˆæ•°ã¨é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Computer</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;computername&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesReceived</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>), <span style=color:#a6e22e>Sent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesSent</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ProcessName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>SentMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>ReceivedMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>ProcessName</span>, <span style=color:#a6e22e>SentMb</span>, <span style=color:#a6e22e>ReceivedMb</span>, <span style=color:#a6e22e>TotalMb</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>3</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å—ä¿¡ãƒã‚¤ãƒˆæ•°ã¨é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é€ä¿¡/ç§’ã¨å—ä¿¡/ç§’ã€æ™‚é–“æ ã®30åˆ†å¹³å‡ã‚’ç¤ºã™ã‚°ãƒ©ãƒ•</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Perf</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Computer</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;computername&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ObjectName</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Network Adapter&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>InstanceName</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Microsoft Hyper-V Network Adapter _2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>CounterValue</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>CounterName</span>, <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>30</span><span style=color:#a6e22e>min</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>desc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®é€ä¿¡/ç§’ã¨å—ä¿¡/ç§’ã€æ™‚é–“æ ã®30åˆ†å¹³å‡ã‚’ç¤ºã™ã‚°ãƒ©ãƒ•</p></details></div><div><details><summary>å—ä¿¡ãƒã‚¤ãƒˆæ•°ã¨é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€šä¿¡ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Computer</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;computername&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>DNS</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>parse_json</span>(<span style=color:#a6e22e>RemoteDnsQuestions</span>)[<span style=color:#ae81ff>0</span>])
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesReceived</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>), <span style=color:#a6e22e>Sent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesSent</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>DestinationIp</span>, <span style=color:#a6e22e>DNS</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>SentMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>ReceivedMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>DestinationIp</span>, <span style=color:#a6e22e>SentMb</span>, <span style=color:#a6e22e>ReceivedMb</span>, <span style=color:#a6e22e>TotalMb</span>, <span style=color:#a6e22e>DNS</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>3</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å—ä¿¡ãƒã‚¤ãƒˆæ•°ã¨é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€šä¿¡ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>å—ä¿¡ãŠã‚ˆã³é€ä¿¡ã®é€šä¿¡ã‚¤ãƒ™ãƒ³ãƒˆãŒæœ€ã‚‚å¤šã„ä¸Šä½ 10 å°ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Events</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Computer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>10</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Events</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å—ä¿¡ãŠã‚ˆã³é€ä¿¡ã®é€šä¿¡ã‚¤ãƒ™ãƒ³ãƒˆãŒæœ€ã‚‚å¤šã„ä¸Šä½ 10 å°ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>ã»ã¨ã‚“ã©ã®é€šä¿¡ã‚¤ãƒ™ãƒ³ãƒˆã§ä¸Šä½ 10 å€‹ã®ãƒãƒ¼ãƒˆã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Events</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>DestinationPort</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>10</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Events</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã»ã¨ã‚“ã©ã®é€šä¿¡ã‚¤ãƒ™ãƒ³ãƒˆã§ä¸Šä½ 10 å€‹ã®ãƒãƒ¼ãƒˆã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>å—ä¿¡ãƒã‚¤ãƒˆæ•°ã¨é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€šä¿¡ãƒãƒ¼ãƒˆã‚’èª¿æŸ»ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesReceived</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>), <span style=color:#a6e22e>Sent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesSent</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>DestinationPort</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>SentMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>ReceivedMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>DestinationPort</span>, <span style=color:#a6e22e>SentMb</span>, <span style=color:#a6e22e>ReceivedMb</span>, <span style=color:#a6e22e>TotalMb</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>3</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å—ä¿¡ãƒã‚¤ãƒˆæ•°ã¨é€ä¿¡ãƒã‚¤ãƒˆæ•°ã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€šä¿¡ãƒãƒ¼ãƒˆã‚’èª¿æŸ»ã™ã‚‹</p></details></div><div><details><summary>ãƒ—ãƒ­ã‚»ã‚¹åã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€šä¿¡ãƒãƒ¼ãƒˆã‚’èª¿ã¹ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMConnection</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesReceived</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>), <span style=color:#a6e22e>Sent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>BytesSent</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1024</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ProcessName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>SentMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Sent</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>ReceivedMb</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Received</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>ProcessName</span>, <span style=color:#a6e22e>SentMb</span>, <span style=color:#a6e22e>ReceivedMb</span>, <span style=color:#a6e22e>TotalMb</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>3</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TotalMb</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒ—ãƒ­ã‚»ã‚¹åã«åŸºã¥ã„ã¦ä¸Šä½ 3 ã¤ã®é€šä¿¡ãƒãƒ¼ãƒˆã‚’èª¿ã¹ã‚‹</p></details></div><h3 id=compute>Compute</h3><div><details><summary>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã”ã¨ã«æœ€å¾Œã®ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’å–å¾—ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Heartbeat</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>LastHeartBeat</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>arg_max</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#f92672>*</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Computer</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Microsoft ç›£è¦–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã«å±•é–‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã€1 åˆ†ã”ã¨ã«ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã®ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸæœ€å¾Œã®ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’ç¢ºèªã§ãã¾ã™ã€‚</p></details></div><div><details><summary>5åˆ†é–“ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’é€ã£ã¦ã„ãªã„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Heartbeat</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>LastHeartBeat</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>arg_max</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#f92672>*</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Computer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>LastHeartBeat</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>)
</span></span></code></pre></div></p><p>è§£èª¬ :<br>5åˆ†é–“ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’é€ã£ã¦ã„ãªã„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹</p></details></div><div><details><summary>éå» 4 æ™‚é–“ã«é›†è¨ˆã•ã‚ŒãŸã™ã¹ã¦ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®ãƒ‡ã‚£ã‚¹ã‚¯ç©ºãå®¹é‡ã®å‰²åˆã‚’ç¢ºèªã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>InsightsMetrics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>4</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Namespace</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;LogicalDisk&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Name</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;FreeSpacePercentage&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>DiskInstance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>parse_json</span>(<span style=color:#a6e22e>Tags</span>).[<span style=color:#e6db74>&#34;vm.azm.ms/mountId&#34;</span>])
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>DiskFreeSpace</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>Val</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>4</span><span style=color:#a6e22e>h</span>), <span style=color:#a6e22e>Computer</span>, <span style=color:#a6e22e>DiskInstance</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>VM ã‚¤ãƒ³ã‚µã‚¤ãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€ã™ã¹ã¦ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ãŒã‚¤ãƒ³ã‚µã‚¤ãƒˆ ãƒ¡ãƒˆãƒªãƒƒã‚¯ ãƒ†ãƒ¼ãƒ–ãƒ«ã«åé›†ã•ã‚Œã¾ã™ã€‚ã“ã®ã‚¯ã‚¨ãƒªã¯ã€éå» 4 æ™‚é–“ã«é›†è¨ˆã•ã‚ŒãŸã™ã¹ã¦ã®ãƒ‡ã‚£ã‚¹ã‚¯ã®ç©ºãé ˜åŸŸã®å‰²åˆã‚’ç¤ºã—ã¾ã™ã€‚</p></details></div><div><details><summary>ã™ã¹ã¦ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æ›´æ–°ç®¡ç†ã®æœ€æ–°ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>UpdateSummary</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>arg_max</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#f92672>*</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Computer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>Computer</span>, <span style=color:#a6e22e>LastUpdateApplied</span>, <span style=color:#a6e22e>OldestMissingSecurityUpdateInDays</span>, <span style=color:#a6e22e>WindowsUpdateSetting</span>, <span style=color:#a6e22e>SecurityUpdatesMissing</span>, <span style=color:#a6e22e>OtherUpdatesMissing</span>, <span style=color:#a6e22e>RestartPending</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>æ›´æ–°ã®ç®¡ç†ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ã“ã®ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ã€å„ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã®æœ€æ–°ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚</p></details></div><div><details><summary>éå» 7 æ—¥é–“ã®å„æ›´æ–°ã‚¸ãƒ§ãƒ–ã®çŠ¶æ…‹ã‚’è¡¨ç¤ºã—ã¾ã™</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>UpdateRunProgress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>7</span><span style=color:#a6e22e>d</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Failed</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countif</span>(<span style=color:#a6e22e>InstallationStatus</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Failed&#34;</span>), <span style=color:#a6e22e>FailedtoStart</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countif</span>(<span style=color:#a6e22e>InstallationStatus</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;FailedtoStart&#34;</span>), <span style=color:#a6e22e>InProgress</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countif</span>(<span style=color:#a6e22e>InstallationStatus</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;InProgress&#34;</span>), <span style=color:#a6e22e>Succeeded</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countif</span>(<span style=color:#a6e22e>InstallationStatus</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Succeeded&#34;</span>), <span style=color:#a6e22e>NotIncluded</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countif</span>(<span style=color:#a6e22e>InstallationStatus</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;NotIncluded&#34;</span>), <span style=color:#a6e22e>NotStarted</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>countif</span>(<span style=color:#a6e22e>InstallationStatus</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;NotStarted&#34;</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>UpdateRunName</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã“ã®ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ã€éå» 7 æ—¥é–“ã®å„æ›´æ–°ã‚¸ãƒ§ãƒ–ã®å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°æ•°ã‚’ç¢ºèªã—ã¾ã™ã€‚</p></details></div><h3 id=data>Data</h3><div><details><summary>Azure SQL Database: SQL Database ã§å‡ºåŠ›å¯èƒ½ãªã‚«ãƒ†ã‚´ãƒªã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Category</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã€ŒDatabaseWaitStatisticsã€ã‚«ãƒ†ã‚´ãƒªã§ã¯æŒ‡å®šã—ãŸç¯„å›²æœŸé–“å†…ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã§ç™ºç”Ÿã—ãŸå†…éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®å¾…æ©Ÿæ™‚é–“ã®è©³ç´°ãŒç¢ºèªã§ãã¾ã™ã€‚ã€ŒQueryStoreWaitStatisticsã€ã‚«ãƒ†ã‚´ãƒªã§ã¯ã‚¯ã‚¨ãƒªã‚¹ãƒˆã‚¢å†…ã«æ ¼ç´ã•ã‚ŒãŸæƒ…å ±å…¨ä½“ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã§ç™ºç”Ÿã—ãŸå†…éƒ¨ãƒªã‚½ãƒ¼ã‚¹ã®å¾…æ©Ÿæ™‚é–“ã®è©³ç´°ãŒç¢ºèªã§ãã¾ã™ã€‚ã€ŒErrorsã€ã‚«ãƒ†ã‚´ãƒªã§ã¯ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Database: ãƒªã‚½ãƒ¼ã‚¹å¾…æ©Ÿæ™‚é–“ã®è©³ç´°ã‚’å††ã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;DatabaseWaitStatistics&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>delta_wait_time_ms_d</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>wait_type_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>sort</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>sum_delta_wait_time_ms_d</span> <span style=color:#a6e22e>desc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>piechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å¾…æ©Ÿæ™‚é–“ã®å¤šã„ãƒªã‚½ãƒ¼ã‚¹ã«ç€ç›®ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®ç³¸å£ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Database: ãƒªã‚½ãƒ¼ã‚¹å¾…æ©Ÿå›æ•°ã®è©³ç´°ã‚’å††ã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;DatabaseWaitStatistics&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>delta_waiting_tasks_count_d</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>wait_type_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>sort</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>sum_delta_waiting_tasks_count_d</span> <span style=color:#a6e22e>desc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>piechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å¾…æ©Ÿå›æ•°ã®å¤šã„ãƒªã‚½ãƒ¼ã‚¹ã«ç€ç›®ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®ç³¸å£ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Database: ã‚¯ã‚¨ãƒªã‚¹ãƒˆã‚¢å†…ã«æ ¼ç´ã•ã‚ŒãŸãƒªã‚½ãƒ¼ã‚¹å¾…æ©Ÿæ™‚é–“æƒ…å ±ã®è©³ç´°ã‚’å††ã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;QueryStoreWaitStatistics&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>total_query_wait_time_ms_d</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>wait_category_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>sort</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>sum_total_query_wait_time_ms_d</span> <span style=color:#a6e22e>desc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>piechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>å¾…æ©Ÿæ™‚é–“ã®å¤šã„ãƒªã‚½ãƒ¼ã‚¹ã«ç€ç›®ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ã®ç³¸å£ã‚’ç™ºè¦‹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¯ã‚¨ãƒªã‚¹ãƒˆã‚¢å†…ã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1ãƒµæœˆåˆ†ã®æƒ…å ±ãŒæ ¼ç´ã•ã‚Œã‚‹ãŸã‚ã€ã‚ˆã‚Šåºƒã„ç¯„å›²ã§ã®ç¢ºèªãŒå¯èƒ½ã§ã™ã€‚</p></details></div><div><details><summary>Azure SQL Database: SQL Database ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Errors&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#a6e22e>error_number_d</span>, <span style=color:#a6e22e>Severity</span>, <span style=color:#a6e22e>state_d</span>, <span style=color:#a6e22e>Message</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ã¯é¡•åœ¨åŒ–ã—ãŸéšœå®³ã®è§£æ±ºã‚„ã€æ½œåœ¨çš„ãªéšœå®³ã‚’æœªç„¶ã«é˜²æ­¢ã™ã‚‹ã“ã¨ã«ã¤ãªãŒã‚Šã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Database: SQL Database ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼æ•°ã‚’æ™‚ç³»åˆ—ã«æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Errors&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TimeGenerated</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span>  
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã®å›æ•°ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ã¯é¡•åœ¨åŒ–ã—ãŸéšœå®³ã®è§£æ±ºã‚„ã€æ½œåœ¨çš„ãªéšœå®³ã‚’æœªç„¶ã«é˜²æ­¢ã™ã‚‹ã“ã¨ã«ã¤ãªãŒã‚Šã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Managed Instance: ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ResourceUsageStats&#34;</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Category ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã« &ldquo;ResourceUsageStats&rdquo; ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€Azure SQL Managed Instance ã®æ§˜ã€…ãªãƒªã‚½ãƒ¼ã‚¹ã®ä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Managed Instance: å¹³å‡ CPU ä½¿ç”¨ç‡ã€èª­ã¿è¾¼ã¿ãƒã‚¤ãƒˆæ•°ã€æ›¸ãè¾¼ã¿ãƒã‚¤ãƒˆæ•°ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ResourceUsageStats&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>avg_cpu_percent_s</span>, <span style=color:#a6e22e>io_bytes_read_s</span>, <span style=color:#a6e22e>io_bytes_written_s</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ç§’ã”ã¨ã® CPU ä½¿ç”¨ç‡ã¯ avg_cpu_percent_s åˆ—ã€ç§’ã”ã¨ã®èª­ã¿å–ã‚Šãƒã‚¤ãƒˆæ•°ã¯ io_bytes_read_s åˆ—ã€ç§’ã”ã¨ã®æ›¸ãè¾¼ã¿ãƒã‚¤ãƒˆæ•°ã¯ io_bytes_written åˆ—ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p></details></div><div><details><summary>Azure SQL Managed Instance: å¹³å‡ CPU ä½¿ç”¨ç‡ã€èª­ã¿è¾¼ã¿ãƒã‚¤ãƒˆæ•°ã€æ›¸ãè¾¼ã¿ãƒã‚¤ãƒˆæ•°ã® 5 åˆ†ã”ã¨ã®å¹³å‡å€¤ã‚’ã€æ™‚åˆ»ã§ä¸¦ã¹æ›¿ãˆã¦æ˜‡é †ã«è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ResourceUsageStats&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>sort</span> <span style=color:#a6e22e>by</span>  <span style=color:#a6e22e>asc</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>todouble</span>(<span style=color:#a6e22e>avg_cpu_percent_s</span>)), <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>todouble</span>(<span style=color:#a6e22e>io_bytes_read_s</span>)), <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>todouble</span>(<span style=color:#a6e22e>io_bytes_written_s</span>)) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>)
</span></span></code></pre></div></p><p>è§£èª¬ :<br>avg_cpu_percent_s åˆ—ã€io_bytes_read_s åˆ—ãŠã‚ˆã³ io_bytes_written åˆ—ã¯æ–‡å­—åˆ—å‹ãªã®ã§ã€å¹³å‡å€¤ã‚’æ±‚ã‚ã‚‹ãŸã‚ã«æ•°å€¤å‹ã«å¤‰æ›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€æ™‚ç³»åˆ—ã§è¡¨ç¤ºã™ã‚‹ãŸã‚ã« TimeGenerated ã§ä¸¦ã¹æ›¿ãˆã‚’è¡Œã„ã¾ã™ã€‚</p></details></div><div><details><summary>Azure SQL Managed Instance: å¹³å‡ CPU ä½¿ç”¨ç‡ã€èª­ã¿è¾¼ã¿ãƒã‚¤ãƒˆæ•°ã€æ›¸ãè¾¼ã¿ãƒã‚¤ãƒˆæ•°ã® 5 åˆ†ã”ã¨ã®å¹³å‡å€¤ã‚’ã€æ™‚åˆ»ã§æ˜‡é †ã«ä¸¦ã¹æ›¿ãˆã¦æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ResourceUsageStats&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>sort</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>asc</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>todouble</span>(<span style=color:#a6e22e>avg_cpu_percent_s</span>)), <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>todouble</span>(<span style=color:#a6e22e>io_bytes_read_s</span>)), <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>todouble</span>(<span style=color:#a6e22e>io_bytes_written_s</span>)) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>render ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ timechart ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã¨ã‚‚ã«ä½¿ç”¨ã—ã¦æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p></details></div><div><details><summary>Azure Synapse Analytics Dedicated SQL Pool: éå» 30 æ—¥ã®æœŸé–“å†…ã§ã€å®Ÿè¡Œã®æ™‚é–“ã®é•·ã„ã‚¯ã‚¨ãƒªä¸Šä½ 20 ä»¶ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ (ã‚¯ã‚¨ãƒªè§£æ ã‚¹ãƒ†ãƒƒãƒ— 1)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;ExecRequests&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>StatementType_s</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;Batch&#39;</span>,<span style=color:#e6db74>&#39;Execute&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Session_ID</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>SessionId_s</span>),<span style=color:#a6e22e>Request_ID</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>RequestId_s</span>),<span style=color:#a6e22e>Submit_Time</span><span style=color:#f92672>=</span><span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>SubmitTime_t</span>),<span style=color:#a6e22e>Start_Time</span><span style=color:#f92672>=</span><span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>StartTime_t</span>),<span style=color:#a6e22e>End_Time</span><span style=color:#f92672>=</span><span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>EndTime_t</span>),<span style=color:#a6e22e>Command</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Command_s</span>),<span style=color:#a6e22e>Status</span><span style=color:#f92672>=</span><span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>Status_s</span>), <span style=color:#a6e22e>Statement_Type</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>StatementType_s</span>),<span style=color:#a6e22e>Resource_class</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>ResourceClass_s</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>RequestId_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>ElapsedTime_min</span><span style=color:#f92672>=</span><span style=color:#a6e22e>anyif</span>((<span style=color:#a6e22e>End_Time</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Start_Time</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span><span style=color:#a6e22e>m</span>,<span style=color:#a6e22e>Start_Time</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>30</span><span style=color:#a6e22e>d</span>)),<span style=color:#a6e22e>Session_ID</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Session_ID</span>), <span style=color:#a6e22e>Submit_Time</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Submit_Time</span>) ,<span style=color:#a6e22e>Start_Time</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Start_Time</span>), <span style=color:#a6e22e>End_Time</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>End_Time</span>),<span style=color:#a6e22e>Command</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Command</span>),<span style=color:#a6e22e>Status</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Status</span>),<span style=color:#a6e22e>Statement_Type</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Statement_Type</span>),<span style=color:#a6e22e>Resource_class</span><span style=color:#f92672>=</span><span style=color:#a6e22e>any</span>(<span style=color:#a6e22e>Resource_class</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Request_ID</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ElapsedTime_min</span> <span style=color:#a6e22e>desc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>limit</span> <span style=color:#ae81ff>20</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Dedicated SQL Poolã® ExecRequests ã‚«ãƒ†ã‚´ãƒªã§ã¯ã€ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œæ™‚é–“ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œæ™‚é–“/çŠ¶æ…‹ã«ã‚ˆã£ã¦ã¯ã€è¤‡æ•°è¡Œã«æ¸¡ã£ã¦ä¸€ã¤ã®ã‚¯ã‚¨ãƒªã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ã€summarize ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦å¿…è¦ãªæƒ…å ±ã ã‘ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚å‡¦ç†æ™‚é–“ã¯ã‚¯ã‚¨ãƒªçµ‚äº†æ™‚é–“(End_Time)ã¨é–‹å§‹æ™‚é–“(Start_Time)ã®å·®ã‹ã‚‰è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚ã‚ˆã‚Šé•·ã„æœŸé–“ã®ç¢ºèªãŒå¿…è¦ãªå ´åˆã¯ ago ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å¼•æ•°ã®å€¤ã‚’å¢—ã‚„ã—ã¦ãã ã•ã„ (ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ 30d (30æ—¥)ã¨ã—ã¦ã„ã¾ã™)ã€‚ã¾ãŸã€è¡¨ç¤ºä»¶æ•°ã‚’å¢—ã‚„ã™å ´åˆã¯ limit ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å€¤ã‚’å¢—ã‚„ã—ã¦ãã ã•ã„ã€‚Request_ID åˆ—ã®å€¤ã¯ã‚¹ãƒ†ãƒƒãƒ— 2ã§ä½¿ç”¨ã—ã¾ã™ã€‚</p></details></div><div><details><summary>Azure Synapse Analytics Dedicated SQL Pool: åˆ†æ•£ã‚¯ã‚¨ãƒªã®å„ã‚¹ãƒ†ãƒƒãƒ—ã§å‡¦ç†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ä»¶æ•°ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ (ã‚¯ã‚¨ãƒªè§£æ ã‚¹ãƒ†ãƒƒãƒ— 2)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span>  <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;RequestSteps&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>RequestId_s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;QIDnnnnnn&#39;</span> <span style=color:#75715e>//Put your QueryID here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Status_s</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;Running&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>StartTime_t</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>EndTime_t</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>RequestId_s</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>OperationType_s</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>RowCount_d</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>Command_s</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>Status_s</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>StepIndex_d</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>StepIndex_d</span> <span style=color:#a6e22e>asc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Dedicated SQL Poolã® RequestSteps ã‚«ãƒ†ã‚´ãƒªã§ã¯ã€åˆ†æ•£ã‚¯ã‚¨ãƒªã®å„ã‚¹ãƒ†ãƒƒãƒ—ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€ç•ªé•·ãæ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€å¯¾å‡¦æ–¹æ³•ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è§£æå¯¾è±¡ã¨ã—ãŸã„ã‚¯ã‚¨ãƒªã® Request_ID ã®å€¤ (ã‚¯ã‚¨ãƒªè§£æ ã‚¹ãƒ†ãƒƒãƒ— 1ã«ã¦å–å¾—)ã‚’ã€ã‚¯ã‚¨ãƒªå†…ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</p></details></div><div><details><summary>Azure Synapse Analytics Dedicated SQL Pool: éå» 30 æ—¥ã®æœŸé–“å†…ã§ã€å‡¦ç†ä»¶æ•°ã®å¤šã„ã‚¯ã‚¨ãƒªã‚¹ãƒ†ãƒƒãƒ—ä¸Šä½ 20 ä»¶ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ (ã‚¯ã‚¨ãƒªè§£æ ã‚¹ãƒ†ãƒƒãƒ— 3)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span>  <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;RequestSteps&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>elapsedTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>EndTime_t</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>StartTime_t</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>elapsedTime_min</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>elapsedTime</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1</span><span style=color:#a6e22e>m</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>EndTime_t</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>30</span><span style=color:#a6e22e>d</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>StartTime_t</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>30</span><span style=color:#a6e22e>d</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>RowCount_d</span> <span style=color:#a6e22e>desc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>RequestId_s</span>,<span style=color:#a6e22e>OperationType_s</span>, <span style=color:#a6e22e>RowCount_d</span>,<span style=color:#a6e22e>elapsedTime_min</span> , <span style=color:#a6e22e>StartTime_t</span>, <span style=color:#a6e22e>EndTime_t</span>, <span style=color:#a6e22e>Status_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>limit</span> <span style=color:#ae81ff>20</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Dedicated SQL Poolã® RequestSteps ã‚«ãƒ†ã‚´ãƒªã§ã¯ã€åˆ†æ•£ã‚¯ã‚¨ãƒªã®å„ã‚¹ãƒ†ãƒƒãƒ—ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¸€ç•ªé•·ãæ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã‚¯ã‚¨ãƒªã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã€å¯¾å‡¦ãŒå¿…è¦ãªã‚¯ã‚¨ãƒªã®ç™ºè¦‹ãŒå¯èƒ½ã§ã™ã€‚ã‚ˆã‚Šé•·ã„æœŸé–“ã®ç¢ºèªãŒå¿…è¦ãªå ´åˆã¯ ago ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å¼•æ•°ã®å€¤ã‚’å¢—ã‚„ã—ã¦ãã ã•ã„ (ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ 30d (30æ—¥)ã¨ã—ã¦ã„ã¾ã™)ã€‚ã¾ãŸã€è¡¨ç¤ºä»¶æ•°ã‚’å¢—ã‚„ã™å ´åˆã¯ limit ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å€¤ã‚’å¢—ã‚„ã—ã¦ãã ã•ã„ã€‚Request_ID åˆ—ã®å€¤ã¯ã‚¹ãƒ†ãƒƒãƒ— 4ã§ä½¿ç”¨ã—ã¾ã™ã€‚</p></details></div><div><details><summary>Azure Synapse Analytics Dedicated SQL Pool: å‡¦ç†ä»¶æ•°ãŒå¤šã„åˆ†æ•£ã‚¯ã‚¨ãƒªã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¯ã‚¨ãƒªå…¨ä½“ã®å‡¦ç†æ™‚é–“ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ (ã‚¯ã‚¨ãƒªè§£æ ã‚¹ãƒ†ãƒƒãƒ— 4)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span>  <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;RequestSteps&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>RequestId_s</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;QIDnnnnn&#39;</span> <span style=color:#75715e>//Insert your QID here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Status_s</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;Running&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>StartTime_t</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>EndTime_t</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>RequestId_s</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>OperationType_s</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>RowCount_d</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>Command_s</span>),<span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>Status_s</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>StepIndex_d</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>StepIndex_d</span> <span style=color:#a6e22e>asc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Dedicated SQL Poolã® ExecRequests ã‚«ãƒ†ã‚´ãƒªã§ã¯ã€ã‚¯ã‚¨ãƒªå‡¦ç†çŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è§£æå¯¾è±¡ã¨ã—ãŸã„ã‚¯ã‚¨ãƒªã® Request_ID ã®å€¤ (ã‚¯ã‚¨ãƒªè§£æ ã‚¹ãƒ†ãƒƒãƒ— 2ã«ã¦å–å¾—)ã‚’ã€ã‚¯ã‚¨ãƒªå†…ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</p></details></div><h3 id=avd>AVD</h3><div><details><summary>AVD ã®è¨ºæ–­ãƒ­ã‚°ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¸€è¦§ã§è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>search</span> <span style=color:#f92672>*</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>distinct</span> <span style=color:#a6e22e>$table</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>$table</span> <span style=color:#a6e22e>startswith</span> <span style=color:#e6db74>&#34;WVD&#34;</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>AVD ã«é–¢é€£ã™ã‚‹è¨ºæ–­ãƒ­ã‚°ã¯ç”¨é€”æ¯ã«åˆ¥ã€…ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ã“ã“ã§ã¯ AVD ã«é–¢é€£ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸€è¦§ï¼ˆãƒ­ã‚°ãŒ 24 æ™‚é–“ä»¥å†…ã«å‡ºåŠ›ã•ã‚ŒãŸã‚‚ã®ã«é™ã‚‹ï¼‰ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
AVD ã®è¨ºæ–­ãƒ­ã‚°ã«ã¤ã„ã¦ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ãã ã•ã„ã€‚<br><a href=https://docs.microsoft.com/ja-jp/azure/virtual-desktop/diagnostics-log-analytics>https://docs.microsoft.com/ja-jp/azure/virtual-desktop/diagnostics-log-analytics</a></p></details></div><div><details><summary>éå» 24 æ™‚é–“ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã®æ¨ç§»ã‚’ 5 åˆ†åˆ»ã¿ã§ã‚°ãƒ©ãƒ•åŒ–</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDAgentHealthStatus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>TotalActiveSessions</span><span style=color:#f92672>=</span><span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>toint</span>(<span style=color:#a6e22e>ActiveSessions</span>))<span style=color:#f92672>/</span><span style=color:#ae81ff>10</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>AVD Agent ã¯ 30 ç§’ãŠãã«ãƒ›ã‚¹ãƒˆä¸Šã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ãªã©ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±ã‚’ &lsquo;WVDAgentHealthStatus&rsquo; ãƒ†ãƒ¼ãƒ–ãƒ«ã«é€ä¿¡ã—ã¦ã„ã¾ã™ã€‚
ã“ã®ã‚¯ã‚¨ãƒªã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ•°ã‚’ sum() é–¢æ•°ã«ã‚ˆã‚Šé›†è¨ˆã—ã¦ã‚°ãƒ©ãƒ•åŒ–ã—ã¦ã„ã¾ã™ã€‚</p></details></div><div><details><summary>éå» 24 æ™‚é–“ã®ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã®æ¨ç§»ã‚’ 5 åˆ†åˆ»ã¿ã§ã‚°ãƒ©ãƒ•åŒ–</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDAgentHealthStatus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>TotalInactiveSessions</span><span style=color:#f92672>=</span><span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>toint</span>(<span style=color:#a6e22e>InactiveSessions</span>))<span style=color:#f92672>/</span><span style=color:#ae81ff>10</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>5</span><span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ x ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹ãªã©ã—ã¦ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ã¯ãªã„ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ®‹ã£ã¦ã„ã‚‹ã‚‚ã®ï¼‰ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’ sum() é–¢æ•°ã«ã‚ˆã‚Šé›†è¨ˆã—ã¦ã‚°ãƒ©ãƒ•åŒ–ã—ã¦ã„ã¾ã™ã€‚</p></details></div><div><details><summary>ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆæ¯ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¨ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDAgentHealthStatus</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>arg_max</span>(<span style=color:#a6e22e>TimeGenerated</span>,<span style=color:#f92672>*</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>SessionHostName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>SessionHostName</span>, <span style=color:#a6e22e>ActiveSessions</span>, <span style=color:#a6e22e>InactiveSessions</span>, <span style=color:#a6e22e>TimeGenerated</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ç¾æ™‚ç‚¹ï¼ˆéå» 10 åˆ†ä»¥å†…ï¼‰ã§æ­£å¸¸ç¨¼åƒã—ã¦ã„ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã‹ã‚‰ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼ã‚¤ãƒ³ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³æ•°ã‚’ãƒ›ã‚¹ãƒˆæ¯ã«è¡¨ç¤º</p></details></div><div><details><summary>éå» 24 æ™‚é–“ä»¥å†…ã«ç™ºç”Ÿã—ãŸ AVD ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã«èµ·å› ã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDErrors</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>) 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ServiceError</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;true&#34;</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ServiceError ã‚«ãƒ©ãƒ ãŒ true ã¨ãªã£ã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¨ãƒ©ãƒ¼ã¯ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆ ã‚µãƒãƒ¼ãƒˆã¸ã®å•ã„åˆã‚ã›ãŒå¿…è¦ãªå•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™</p></details></div><div><details><summary>éå» 24 æ™‚é–“ä»¥å†…ã«ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã®æ•°ã‚’ç¨®é¡ã”ã¨ã«é›†è¨ˆ</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDErrors</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>) 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ServiceError</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;false&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>NumOfErrors</span><span style=color:#f92672>=</span><span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ActivityType</span>, <span style=color:#a6e22e>Source</span>, <span style=color:#a6e22e>CodeSymbolic</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>sort</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Source</span>
</span></span></code></pre></div></p><p>Description :<br></p></details></div><div><details><summary>éå» 24 æ™‚é–“ä»¥å†…ã«ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã®æ•°ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã«é›†è¨ˆ</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDErrors</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>) 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ServiceError</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;false&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>NumOfErrors</span><span style=color:#f92672>=</span><span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>UserName</span>
</span></span></code></pre></div></p><p>Description :<br></p></details></div><div><details><summary>éå» 24 æ™‚é–“ä»¥å†…ã« &lt;<em>User UPN</em>> ã«æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDErrors</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>) 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ServiceError</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;false&#34;</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>UserName</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&lt;User UPN&gt;&#34;</span>
</span></span></code></pre></div></p><p>Description :<br></p></details></div><div><details><summary>éå» 24 æ™‚é–“ã«ãŠã‘ã‚‹ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«æ¯ã®æ¥ç¶šå…ƒ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDConnections</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>Multi</span><span style=color:#f92672>=</span><span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>_ResourceId</span>, <span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>HostPool</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>Multi</span>[<span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ClientSideIPAddress</span>, <span style=color:#a6e22e>HostPool</span>
</span></span></code></pre></div></p><p>Description :<br></p></details></div><div><details><summary>éå» 24 æ™‚é–“ã® &lt;<em>Host Pool</em>> ã§æŒ‡å®šã—ãŸãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«ã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®æ¥ç¶šæ™‚é–“ã‚’è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDConnections</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>Multi</span><span style=color:#f92672>=</span><span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>_ResourceId</span>, <span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>HostPool</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>Multi</span>[<span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>HostPool</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&lt;Host Pool&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>State</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Connected&#34;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>CorrelationId</span>, <span style=color:#a6e22e>UserName</span>, <span style=color:#a6e22e>StartTime</span><span style=color:#f92672>=</span><span style=color:#a6e22e>TimeGenerated</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>inner</span>(<span style=color:#a6e22e>WVDConnections</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>State</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Completed&#34;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>EndTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#a6e22e>CorrelationId</span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>CorrelationId</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>Duration</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>EndTime</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>StartTime</span>, <span style=color:#a6e22e>UserName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>ConnectionTimeTotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>Duration</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>UserName</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>&lsquo;WVDConnections&rsquo; ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹æ¥ç¶šé–‹å§‹ã‚„åˆ‡æ–­ã®ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
ã“ã®ã‚¯ã‚¨ãƒªã§ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã«æ¥ç¶šã—ã¦ã‹ã‚‰åˆ‡æ–­ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’é›†è¨ˆã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®æ¥ç¶šæ™‚é–“ã®ç´¯è¨ˆå€¤ã‚’ç®—å‡ºã—ã¦ã„ã¾ã™ã€‚
åŒã˜ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹æ¥ç¶šã¨åˆ‡æ–­ã®ãƒ­ã‚°ã¯ &lsquo;CorrelationId&rsquo; ãŒä¸€è‡´ã™ã‚‹ãŸã‚ã€join ã«ã‚ˆã‚Šæ¥ç¶šã¨åˆ‡æ–­ã®ãƒ­ã‚°ã‚’ä¸€ã¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«çºã‚ã¦ã„ã¾ã™ã€‚</p></details></div><div><details><summary>éå» 1 é€±é–“ã® &lt;<em>Host Pool</em>> ã§æŒ‡å®šã—ãŸãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«ã«ãŠã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®æ¥ç¶šæ™‚é–“ã®æ¨ç§»ã‚’è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDConnections</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>7</span><span style=color:#a6e22e>d</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>Multi</span><span style=color:#f92672>=</span><span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>_ResourceId</span>, <span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>HostPool</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>Multi</span>[<span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>HostPool</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&lt;Host Pool&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>State</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Connected&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>CorrelationId</span>, <span style=color:#a6e22e>UserName</span>, <span style=color:#a6e22e>StartTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TimeGenerated</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>inner</span>(<span style=color:#a6e22e>WVDConnections</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>State</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Completed&#34;</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>EndTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#a6e22e>CorrelationId</span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>CorrelationId</span>  
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>DurationInMinutes</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>EndTime</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>StartTime</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>1</span><span style=color:#a6e22e>m</span>, <span style=color:#a6e22e>UserName</span>, <span style=color:#a6e22e>EndTime</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>ConnectionTimeInMinutes</span><span style=color:#f92672>=</span><span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>DurationInMinutes</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>EndTime</span>, <span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>), <span style=color:#a6e22e>UserName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ä¸Šã«æ›¸ã„ãŸã‚¯ã‚¨ãƒªãƒ¼ã‚’æ‹¡å¼µã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã®æ¥ç¶šæ™‚é–“ã®æ—¥æ¬¡æ¨ç§»ã‚’ã‚°ãƒ©ãƒ•åŒ–ã—ã¦ã„ã¾ã™ã€‚
datetime å‹åŒå£«ã§å¼•ãç®—ã‚’ã™ã‚‹ã¨ timespan å‹ã«ãªã‚Šã¾ã™ãŒã€ã“ã®å‹ã®ã¾ã¾ã§ã¯ã‚°ãƒ©ãƒ•åŒ–ã§ããªã„ãŸã‚ã€11 è¡Œç›®ã§ &lsquo;1m&rsquo; ã§å‰²ã‚‹ã“ã¨ã§åˆ†å˜ä½ã®ã‚¹ã‚«ãƒ©ãƒ¼å€¤ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚</p></details></div><div><details><summary>éå» 24 æ™‚é–“ã«ãŠã‘ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒ‡ãƒã‚¤ã‚¹é–“ã®å¿œç­”æ€§ï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ã‚’ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«æ¯ã«è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDConnectionNetworkData</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>Multi</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>_ResourceId</span>, <span style=color:#e6db74>&#34;/&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>HostPool</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>Multi</span>[<span style=color:#ae81ff>8</span>])
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>EstRoundTripTimeInMs</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>), <span style=color:#a6e22e>HostPool</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>&lsquo;WVDConnectionNetworkData&rsquo; ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆæ¥ç¶šæ™‚ã®å¿œç­”æ€§ï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ã®æƒ…å ±ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
ã“ã®ã‚¯ã‚¨ãƒªã§ã¯éå» 24 æ™‚é–“ã«ãŠã‘ã‚‹ãƒ›ã‚¹ãƒˆãƒ—ãƒ¼ãƒ«æ¯ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã®æ¨ç§»ã‚’ã€10 åˆ†æ¯ã®å¹³å‡å€¤ã¨ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p></details></div><div><details><summary>éå» 24 æ™‚é–“ã«ãŠã‘ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ›ã‚¹ãƒˆã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒ‡ãƒã‚¤ã‚¹é–“ã®å¿œç­”æ€§ï¼ˆãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ï¼‰ã‚’ &lt;<em>User UPN</em>> ã§æŒ‡å®šã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¤ã„ã¦è¡¨ç¤º</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>WVDConnectionNetworkData</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>24</span><span style=color:#a6e22e>h</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>inner</span> (<span style=color:#a6e22e>WVDConnections</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>distinct</span> <span style=color:#a6e22e>CorrelationId</span>, <span style=color:#a6e22e>UserName</span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>CorrelationId</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>UserName</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&lt;User UPN&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>EstRoundTripTimeInMs</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>timechart</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã“ã®ã‚¯ã‚¨ãƒªã§ã¯éå» 24 æ™‚é–“ã®ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãŠã‘ã‚‹ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã®æ¨ç§»ã‚’ã€10 åˆ†æ¯ã®å¹³å‡å€¤ã¨ã—ã¦è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p></details></div><h3 id=application-insights>Application Insights</h3><div><details><summary>éå»12æ™‚é–“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é›†è¨ˆã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>requests</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>timestamp</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>12</span><span style=color:#a6e22e>h</span>) 
</span></span></code></pre></div></p><p>è§£èª¬ :<br><code>requests</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã€Application Insights ã§åé›†ã—ãŸHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚</p></details></div><div><details><summary>éå»12æ™‚é–“ã®å¤±æ•—ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é›†è¨ˆã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>requests</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>timestamp</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>12</span><span style=color:#a6e22e>h</span>) 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>success</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>false</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br><code>requests</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­ã«ã¯ã€<code>sucess</code> ã¨ã„ã† <code>boolean</code> å‹ã®è¡ŒãŒã‚ã‚Šã¾ã™ã€‚ <code>success</code> ã‚’ <code>false</code> ã«è¨­å®šã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å¤±æ•—ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é›†è¨ˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p></details></div><div><details><summary>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¹³å‡ã€50ã€95ã€99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ã§é›†è¨ˆã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>requests</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>RequestsCount</span><span style=color:#f92672>=</span><span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>itemCount</span>), <span style=color:#a6e22e>AverageDuration</span><span style=color:#f92672>=</span><span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>duration</span>), <span style=color:#a6e22e>percentiles</span>(<span style=color:#a6e22e>duration</span>, <span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>95</span>, <span style=color:#ae81ff>99</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>operation_Name</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br><code>requests</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­ã«ã¯ã€<code>duration</code> ã¨ã„ã† è¿”ç­”ã«ã‹ã‹ã£ãŸæ™‚é–“ã‚’è¡¨ã™ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚ <code>avg</code> ã‚’ä½¿ãˆã°å¹³å‡ã‚’ã€<code>percentiles</code> ã‚’ä½¿ãˆã°ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ã§ã®é›†è¨ˆãŒå¯èƒ½ã§ã™ã€‚</p></details></div><div><details><summary>ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å…ƒã®å›½ãƒˆãƒƒãƒ—10ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>requests</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>CountByCountry</span><span style=color:#f92672>=</span><span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>client_CountryOrRegion</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>10</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>CountByCountry</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>render</span> <span style=color:#a6e22e>piechart</span>
</span></span></code></pre></div></p><p>Description :<br>NA</p></details></div><div><details><summary>ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>pageViews</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚’é›†è¨ˆã™ã‚‹ãŸã‚ã«ã¯ã€<code>pageViews</code> ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½¿ã„ã¾ã™ã€‚</p></details></div><div><details><summary>ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>pageViews</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>client_type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Browser&#39;</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br><code>pageViews</code> ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä¸­ã« <code>client_type</code> ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚<code>where</code> å¥ã‚’ä½¿ã„ <code>client_type</code> ã‚’ Browser ã«çµã‚‹ã“ã¨ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã§ãã¾ã™ã€‚</p></details></div><div><details><summary>ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„ã€å‡¦ç†ã«ã‹ã‹ã£ãŸæ™‚é–“ã‚’é›†è¨ˆã—ã€ãƒˆãƒƒãƒ—10ã¨ãã®å¹³å‡å€¤ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>pageViews</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>notempty</span>(<span style=color:#a6e22e>duration</span>) <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>client_Type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;Browser&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>total_duration</span><span style=color:#f92672>=</span><span style=color:#a6e22e>duration</span><span style=color:#f92672>*</span><span style=color:#a6e22e>itemCount</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>avg_duration</span><span style=color:#f92672>=</span>(<span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>total_duration</span>)<span style=color:#f92672>/</span><span style=color:#a6e22e>sum</span>(<span style=color:#a6e22e>itemCount</span>)) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>operation_Name</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>top</span> <span style=color:#ae81ff>10</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>avg_duration</span> <span style=color:#a6e22e>desc</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br><code>where</code> å¥ã§ <code>duration</code> ãŒç©ºã§ãªã„ã‚‚ã®ã§ã‹ã¤ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ã‚‚ã®ã‚’åŒºåˆ‡ã‚Šã€<code>extend</code> å¥ã§å‡¦ç†æ™‚é–“ã®åˆè¨ˆå€¤ã¨ã—ã¦ <code>total_duration</code> ã‚’è¨ˆç®—ã—ã¾ã™ã€‚
<code>sumamrize</code> å¥ã§ ã‚¢ã‚¯ã‚»ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‡ãƒ¼ã‚¿ã§ã‚ã‚‹ <code>operation_Name</code> äº‹ã«å¹³å‡å‡¦ç†æ™‚é–“ã‚’å‡ºã—ã¾ã™ã€‚æœ€å¾Œã« <code>top</code> å¥ã‚’ä½¿ã„å¹³å‡å‡¦ç†æ™‚é–“ã®ãƒˆãƒƒãƒ—10ã‚’å‡ºã— <code>desc</code> ã§ä¸¦ã¹ã‹ãˆã¾ã™ã€‚</p></details></div><h3 id=security>Security</h3><div><details><summary>åŒä¸€ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã™ã‚‹é€£ç¶šçš„ãªãƒ­ã‚°ã‚ªãƒ³ã®å¤±æ•—ã‚’æ¤œå‡ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>unit</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>SigninLogs</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ResultType</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#34;0&#34;</span>, <span style=color:#e6db74>&#34;50125&#34;</span>, <span style=color:#e6db74>&#34;50140&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>loginfailure</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>UserPrincipalName</span>, <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>,<span style=color:#a6e22e>unit</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>loginfailure</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>threshold</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br><p>ã“ã®ã‚¯ã‚¨ãƒªã¯ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚<br>SigninLogs ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ <code>unit</code> ã«è¨­å®šã—ãŸæ™‚é–“å†…ã« <code>threshold</code> ã§è¨­å®šã—ãŸå›æ•°ã‚’è¶…ãˆã‚‹ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®å¤±æ•—ã‚’æ¤œå‡ºã—ã¾ã™ã€‚<br>ResultType ã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®çµæœãŒå«ã¾ã‚Œã€0 ã¯ã‚µã‚¤ãƒ³ã‚¤ãƒ³ãŒæˆåŠŸã—å•é¡ŒãŒãªã„ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚50125 ã¨ 50140 ã¯ãã‚Œãã‚Œãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸå ´åˆã¨ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®è¨˜æ†¶ã‚’è¨­å®šã—ãŸå ´åˆã«è¨˜éŒ²ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã§ã€é »ç¹ã«ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹å¤±æ•—ã§ã¯ãªã„ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ã€‚</p><p>SigninLogs ã¯ Azure AD ã«å¯¾ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã©ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚ã“ã®ãƒ­ã‚°ã¯ Azure AD ã®è¨ºæ–­è¨­å®šã‹ã‚‰æœ‰åŠ¹åŒ–ã™ã‚‹ã“ã¨ãŒã§ãã€æœ‰åŠ¹åŒ–ã«ã¯ Azure AD Premium P1 ã¾ãŸã¯ P2 ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¿…è¦ã§ã™ã€‚
ã“ã‚Œã‚‰ã®ã‚³ãƒ¼ãƒ‰ã¯å°†æ¥å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ã®è©³ç´°ã¯ <a href=https://docs.microsoft.com/azure/active-directory/develop/reference-aadsts-error-codes>Azure AD èªè¨¼ã¨æ‰¿èªã®ã‚¨ãƒ©ãƒ¼ ã‚³ãƒ¼ãƒ‰</a> ã«è¨˜è¼‰ãŒã‚ã‚‹ä»–ã€<a href=https://login.microsoftonline.com/error>https://login.microsoftonline.com/error</a> ã§ã‚³ãƒ¼ãƒ‰ã«å¯¾å¿œã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚</p></p></details></div><div><details><summary>ç•°ãªã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã™ã‚‹é€£ç¶šçš„ãªãƒ­ã‚°ã‚ªãƒ³ã®å¤±æ•—ã‚’æ¤œå‡ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>unit</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>SigninLogs</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ResultType</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#34;0&#34;</span>, <span style=color:#e6db74>&#34;50125&#34;</span>, <span style=color:#e6db74>&#34;50140&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>loginfailure</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dcount</span>(<span style=color:#a6e22e>UserPrincipalName</span>) <span style=color:#a6e22e>by</span>  <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>,<span style=color:#a6e22e>unit</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>loginfailure</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>threshold</span> 
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã“ã®ã‚¯ã‚¨ãƒªã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ã‚¹ãƒ—ãƒ¬ãƒ¼æ”»æ’ƒã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚
ãƒ–ãƒ«ãƒ¼ãƒˆ ãƒ•ã‚©ãƒ¼ã‚¹ã¯ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¤‡æ•°ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è©¦è¡Œã™ã‚‹æ”»æ’ƒã§ã™ãŒã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ­ãƒƒã‚¯ãªã©ã§å›é¿ãƒ»æ¤œå‡ºãŒè¡Œã‚ã‚Œã‚„ã™ã„ãŸã‚ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ—ãƒ¬ãƒ¼ã§ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚ˆãä½¿ã‚ã‚Œã‚„ã™ã„ã‚‚ã®ã«å›ºå®šã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å¤‰ãˆãªãŒã‚‰ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’è©¦è¡Œã—ã¾ã™ã€‚
ã“ã®ã‚¯ã‚¨ãƒªã§ã¯ <code>unit</code> ã§æŒ‡å®šã—ãŸæ™‚é–“å†…ã«è¨˜éŒ²ã•ã‚ŒãŸãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã®å¤±æ•—ã‚’æ•°ãˆã€é–¾å€¤ã‚’è¶ŠãˆãŸã‚‚ã®ã‚’æ¤œå‡ºã—ã¾ã™ã€‚</p></details></div><div><details><summary>Application Gateway ã§éå»ã«è¨˜éŒ²ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã®æ•°ãŒé–¾å€¤ã‚ˆã‚Šå¤šã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lookback</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#a6e22e>lookback</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ApplicationGatewayAccessLog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>httpStatus_d</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>ErrCount</span><span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>clientIP_s</span>,<span style=color:#a6e22e>userAgent_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ErrCount</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>threshold</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ApplicationGateway ã¯è¤‡æ•°ã®ãƒ­ã‚°ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ä¸€ã¤ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã‚ã£ãŸã“ã¨ã‚’è¨˜éŒ²ã™ã‚‹ ApplicationGatewayAccessLog ã‚«ãƒ†ã‚´ãƒªã§ã€IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–‡å­—åˆ—ã€ã‚¢ã‚¯ã‚»ã‚¹å…ˆã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã® URI ã¨ã‚¢ã‚¯ã‚»ã‚¹çµæœã® HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãªã©ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®ãƒ­ã‚°ã¯ AzureDiagnostics ã® ApplicationGatewayAccessLog ã‚«ãƒ†ã‚´ãƒªã«è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚<br>åµå¯Ÿã®ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ HTTP ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ãŸã‚ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚¨ãƒ©ãƒ¼ (300) ä»¥ä¸Šã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚£ãƒ«ã‚¿ã—ã¾ã™ã€‚äºˆã‚è¨­å®šã•ã‚ŒãŸé–¾å€¤ã‚’ä¸Šå›ã‚‹ã‚¨ãƒ©ãƒ¼ã‚’è¨˜éŒ²ã—ãŸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ã§åµå¯Ÿã¨æ€ã‚ã‚Œã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç™ºè¦‹ã—ã¾ã™ã€‚
ã“ã®ã‚¯ã‚¨ãƒªã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã«éšœå®³ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã‚’èª¤æ¤œå‡ºã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€ã¾ãŸæ‹ ç‚¹ã‹ã‚‰è¤‡æ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒï¼‘ã¤ã®ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã‚’çµŒç”±ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã§ã‚‚ã€åŒä¸€ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã®ç™ºä¿¡å…ƒã¨ã¿ãªã•ã‚Œã‚‹ãŸã‚ã†ã¾ãå‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç·©å’Œç­–ã¨ã—ã¦ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ä»–ã«ã‚‚ UserAgent_s ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ–‡å­—åˆ—ã«ã‚ˆã‚Šã‚¢ã‚¯ã‚»ã‚¹å…ƒã‚’åŒºåˆ¥ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ãŒã€ååˆ†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p></details></div><div><details><summary>Application Gateway ã§è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lookback</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#a6e22e>lookback</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ApplicationGatewayAccessLog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>httpStatus_d</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>UriCount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dcount</span>(<span style=color:#a6e22e>requestUri_s</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>clientIP_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>UriCount</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>threshold</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>åµå¯Ÿãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ãƒ‘ã‚¹ã®ç·å½“ãŸã‚Šã‚„è„†å¼±æ€§ã®ã‚ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ã‚¹ã«å¯¾ã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®çµæœå˜ä½æ™‚é–“å†…ã«è¤‡æ•°ã® requestUri_s ã«å¯¾ã—ã¦ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚
dcount ã¯æŒ‡å®šã•ã‚ŒãŸåˆ—ã«å¯¾ã—ã¦ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã™ã‚‹é–¢æ•°ã§ã€ã“ã®ã‚¯ã‚¨ãƒªã§ã¯ clientIP_s ã«å¯¾ã—ã¦ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª requestUri_s ã®æ•°ã€ã¤ã¾ã‚Šç‰¹å®šã® clientIP_s ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ãŒè©¦è¡Œã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ•°ãŒé›†è¨ˆã•ã‚Œã¾ã™ã€‚
ãƒ¬ã‚³ãƒ¼ãƒ‰ httpStatus_d ãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‚‚ã®ã«ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚ã‚‹ IP ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ•°ã‚’é–¾å€¤ã¨æ¯”è¼ƒã—ã¦æ”»æ’ƒã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚<br>å®Ÿéš›ã®æ”»æ’ƒã§ã¯ç™ºä¿¡å…ƒ IP ãŒè¤‡æ•°ã«åˆ†æ•£ã—ã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚‹ã®ã§æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚</p></details></div><div><details><summary>Application Gateway ã§è¤‡æ•°å›ã®ã‚¢ã‚¯ã‚»ã‚¹ ã‚¨ãƒ©ãƒ¼ã®å¾Œã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹ã«æˆåŠŸã—ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lookback</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span><span style=color:#a6e22e>m</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>threshold</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>SuccessIPs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#a6e22e>lookback</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ApplicationGatewayAccessLog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>httpStatus_d</span> <span style=color:#a6e22e>between</span> (<span style=color:#ae81ff>200</span> .. <span style=color:#ae81ff>299</span>) 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>AccessTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>max</span>(<span style=color:#a6e22e>TimeGenerated</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>clientIP_s</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#a6e22e>lookback</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>httpStatus_d</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>inner</span> <span style=color:#a6e22e>SuccessIPs</span> <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>clientIP_s</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>AccessTime</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>ErrBeforeSuccess</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>clientIP_s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ErrBeforeSuccess</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>threshold</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>åµå¯Ÿãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€ã‚¨ãƒ©ãƒ¼ãŒç¶šã„ãŸã‚ã¨ã« HTTP ã®ã‚¢ã‚¯ã‚»ã‚¹æˆåŠŸã‚³ãƒ¼ãƒ‰ãŒã‹ãˆã‚‹å ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ã«æˆåŠŸã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã®ã‚¯ã‚¨ãƒªã§ã¯ ApplicationGatewayAccessLog ã‹ã‚‰ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã”ã¨ã«ã‚¢ã‚¯ã‚»ã‚¹ã«æˆåŠŸã—ãŸæœ€å¾Œã®æ™‚åˆ»ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆã—ã€å…ƒã® ApplicationGatewayAccessLog ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ã ã‘ã‚’æŠ½å‡ºã—ãŸãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¨ join ã—ã¾ã™ã€‚
ã‚¢ã‚¯ã‚»ã‚¹ã«æˆåŠŸã—ãŸæ™‚åˆ»ãŒ AccessTime åˆ—ã«å«ã¾ã‚Œã‚‹ãŸã‚ã€TimeGenerated ãŒã“ã‚Œã‚ˆã‚Šå°ã•ã„ï¼ˆå¤ã„ï¼‰ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ•°ãˆã€ã‚¢ã‚¯ã‚»ã‚¹æˆåŠŸå‰ã«é–¾å€¤ã‚’è¶…ãˆã‚‹å›æ•°ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ãŸã“ã¨ã‚’æ¤œå‡ºã—ã¾ã™ã€‚</p></details></div><div><details><summary>Web Application Firewall ã§æ¤œå‡ºã—ãŸæ”»æ’ƒã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span><span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ApplicationGatewayFirewallLog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>TimeGenerated</span>,<span style=color:#a6e22e>clientIp_s</span>,<span style=color:#a6e22e>hostname_s</span>,<span style=color:#a6e22e>requestUri_s</span>,<span style=color:#a6e22e>ruleSetVersion_s</span>,<span style=color:#a6e22e>ruleId_s</span>,<span style=color:#a6e22e>Message</span>,<span style=color:#a6e22e>details_message_s</span>,<span style=color:#a6e22e>details_data_s</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>WAF ãŒæœ‰åŠ¹ãªå ´åˆ ApplicationGatewayFirewallLog ã‚«ãƒ†ã‚´ãƒªã« WAF ã®ãƒ«ãƒ¼ãƒ«ã«ã‚ˆã‚‹æ¤œå‡ºçµæœã‚’è¨˜éŒ²ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ã‚¯ã‚¨ãƒªã§ã¯ WAF ã®ãƒ«ãƒ¼ãƒ«æ¤œå‡ºã®éš›ã«ã‚ˆãä½¿ã†é …ç›®ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p></details></div><div><details><summary>AzureActivity ã§éå»ï¼‘ã‹æœˆã«ç™ºç”Ÿã—ã¦ã„ãªã‹ã£ãŸæ–°ã—ã„ç®¡ç†æ“ä½œã‚’æ¤œå‡ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>past1month</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AzureActivity</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#a6e22e>between</span> (<span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>30</span><span style=color:#a6e22e>d</span>) .. <span style=color:#a6e22e>startofday</span>(<span style=color:#a6e22e>now</span>()))
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>CategoryValue</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Administrative&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>distinct</span>  <span style=color:#a6e22e>OperationNameValue</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureActivity</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span>  <span style=color:#a6e22e>startofday</span>(<span style=color:#a6e22e>now</span>())
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>CategoryValue</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;Administrative&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>OperationNameValue</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>in</span> (<span style=color:#a6e22e>past1month</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#a6e22e>OperationNameValue</span>, <span style=color:#a6e22e>OperationName</span>, <span style=color:#a6e22e>ResourceGroup</span>, <span style=color:#a6e22e>ResourceProviderValue</span>, <span style=color:#a6e22e>Caller</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>Administrative ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ <code>Administrative</code> ã«ç®¡ç†æ“ä½œã‚’è¨˜éŒ²ã—ã¾ã™ã€‚ã‚·ã‚¹ãƒ†ãƒ ã®å¤‰æ›´ãŒç™ºç”Ÿã—ã¦ã„ãªã„ã¨ãã«ã¯ç®¡ç†æ“ä½œã¯ä¸€å®šã®ã‚‚ã®ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ãŒã€æ€¥ã«è¨˜éŒ²ã•ã‚Œã¦ã„ãªã„æ–°ã—ã„æ“ä½œãŒè¨˜éŒ²ã•ã‚ŒãŸå ´åˆã«ã¯ã€æ–°ã—ãå¤‰æ›´ä½œæ¥­ãŒç™ºç”Ÿã—ãŸã‹ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã®å…†å€™ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p></details></div><div><details><summary>ä»–ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã¯èµ·å‹•ã—ã¦ã„ãªã„ãƒ—ãƒ­ã‚»ã‚¹ã‚’æŒã¤ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>VMProcess</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>UniqueProcesses</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dcount</span>(<span style=color:#a6e22e>Computer</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>ExecutableName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>UniqueProcesses</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> (
</span></span><span style=display:flex><span><span style=color:#a6e22e>VMProcess</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>Computer</span>, <span style=color:#a6e22e>ExecutableName</span>, <span style=color:#a6e22e>ExecutablePath</span>
</span></span><span style=display:flex><span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>ExecutableName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>distinct</span> <span style=color:#a6e22e>ExecutableName</span>, <span style=color:#a6e22e>Computer</span>, <span style=color:#a6e22e>ExecutablePath</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>order</span> <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Computer</span>, <span style=color:#a6e22e>ExecutableName</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã‚µãƒ¼ãƒãƒ¼ ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã§ã¯åŒã˜å½¹å‰²ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã§ã¯åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·å‹•ã™ã‚‹ã“ã¨ã«ãªã‚‹ãŸã‚ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ—ãƒ­ã‚»ã‚¹ãŒèµ·å‹•ã—ã¦ã„ã‚‹å ´åˆã«ã¯ä½•ã‹ç‰¹æ®Šãªæ“ä½œã‚’è¡Œã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ä½•ã‚‰ã‹ã®å¤‰æ›´ä½œæ¥­ã«ä¼´ã†ã‚‚ã®ã§ã‚ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¾µå®³ã‚’ç¤ºå”†ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚</p></details></div><div><details><summary>Secuire Score ã®ï¼‘é€±é–“ã®å¤‰åŒ–ã‚’ç¢ºèªã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>SecureScores</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>TimeGenerated</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ago</span>(<span style=color:#ae81ff>7</span><span style=color:#a6e22e>d</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>SecureScorePercentage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PercentageScore</span><span style=color:#f92672>*</span><span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>AverageScore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>avg</span>(<span style=color:#a6e22e>SecureScorePercentage</span>) <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>bin</span>(<span style=color:#a6e22e>TimeGenerated</span>, <span style=color:#ae81ff>1</span><span style=color:#a6e22e>d</span>)
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚¹ã‚³ã‚¢ã¯ç„¡å„Ÿã§åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ Microsoft Defender for Cloud ã®ãƒã‚¹ãƒãƒ£ ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã®æ©Ÿèƒ½ã§ã™ã€‚
Azure Policy ã‚’ä½¿ç”¨ã—ã¦ã€ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã®æ¨å¥¨è¨­å®šãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã®è¿½åŠ ã‚„æ›´æ–°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒªãƒªãƒ¼ã‚¹ã«ã‚ˆã‚Šæ—¥ã€…å¤‰åŒ–ã™ã‚‹ãŸã‚ã€90% ä»¥ä¸Šã‚’ç¶­æŒã™ã‚‹ã‚ˆã†ã«ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã¾ã—ã‚‡ã†ã€‚</p></details></div><div><details><summary>ApplicationGateway ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ãƒ—ãƒ¼ãƒ«ã®ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã‚’æ¤œå‡ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>backend</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;ApplicationGatewayAccessLog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>serverRouted_s</span> <span style=color:#f92672>&lt;&gt;</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>distinct</span> <span style=color:#a6e22e>serverRouted_s</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AzureFirewallNetworkRule&#34;</span> <span style=color:#a6e22e>or</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AzureFirewallApplicationRule&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#f92672>*</span>  <span style=color:#e6db74>&#34; request from &#34;</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>SourcePort</span> <span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#a6e22e>Dest</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>DestPort</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>TimeGenerated</span>,<span style=color:#a6e22e>SourceIP</span>,<span style=color:#a6e22e>SourcePort</span>,<span style=color:#a6e22e>Dest</span>,<span style=color:#a6e22e>DestPort</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#66d9ef>in</span> (<span style=color:#a6e22e>backend</span>)
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«å¯¾ã™ã‚‹é€šä¿¡ã¯ Web Applicaiton Firewall ã«ã‚ˆã£ã¦ä»¶ã•ã•ã‚Œã¾ã™ãŒã€æ¤œå‡ºã•ã‚Œãªã‹ã£ãŸæ”»æ’ƒã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå—ã‘å–ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¯æ§˜ã€…ãªå‹•ä½œã‚’ã™ã‚‹ã“ã¨ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ãŒã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã® C&C ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã‚’è¡Œã†ãŸã‚ã«ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã‚’ç™ºç”Ÿã•ã›ã‚‹ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚<br>ã“ã®ã‚¯ã‚¨ãƒªã§ã¯ Azure Firewall ãŒä½¿ã‚ã‚Œã¦ã„ã¦ã€å…¨ã¦ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå‘ã‘é€šä¿¡ã¯ Azure Firewall ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã‚‹ç’°å¢ƒã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚
pplicationGateway ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ã‚µãƒ¼ãƒãƒ¼ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ serverRouted_s ã«è¨˜éŒ²ã•ã‚Œã‚‹ãŸã‚ã€serverRouted_s ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
Azure Firewall ã§ã¯ IP ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ«ã€URL ãƒ™ãƒ¼ã‚¹ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ«ãƒ¼ãƒ«ã¨ã‚‚ã«é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¨˜éŒ²ã•ã‚Œã‚‹ãŸã‚ã€é€ä¿¡å…ƒã‚¢ãƒ‰ãƒ¬ã‚¹ãŒäºˆã‚ä½œæˆã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒªã‚¹ãƒˆã¨ä¸€è‡´ã™ã‚‹ã‚‚ã®ãŒãƒ‡ãƒ¼ã‚¿é€ä¿¡ã‚’è¡ŒãŠã†ã¨ã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã™ã€‚</p></details></div><div><details><summary>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã«å¯¾ã—ã¦å¯¾è©±çš„ãƒ­ã‚°ã‚¤ãƒ³ã‚’è¡Œã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>SecurityEvent</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>EventID</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>4624</span> <span style=color:#a6e22e>and</span> (<span style=color:#a6e22e>LogonType</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span> <span style=color:#a6e22e>or</span> <span style=color:#a6e22e>LogonType</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>10</span>) <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>AccountType</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;User&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Computer</span>, <span style=color:#a6e22e>Account</span>
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ä¸€èˆ¬çš„ã«é‹ç”¨ä¸­ã®ã‚µãƒ¼ãƒãƒ¼ã«ã¯ã€å¤‰æ›´ç®¡ç†ã®æœŸé–“ã‚’é™¤ãå¯¾è©±çš„ãƒ­ã‚°ã‚ªãƒ³ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
SecurityEvent ã¯ Windows ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ãŒå¯¾è©±çš„ãƒ­ã‚°ã‚¤ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œå‡ºã™ã‚‹ã“ã¨ã§ç°¡å˜ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
SecurityEvent ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã¯ Defender for Cloud ã®æœ‰å„Ÿ SKU ãŒå¿…è¦ã§ã™ã€‚</p></details></div><div><details><summary>è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ã«å«ã¾ã‚Œã‚‹ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸ã®é€ä¿¡ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ¤œå‡ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maliciousIPs</span> <span style=color:#f92672>=</span> 
</span></span><span style=display:flex><span><span style=color:#a6e22e>ThreatIntelligenceIndicator</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>NetworkIP</span> <span style=color:#f92672>&lt;&gt;</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>Active</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>true</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>ExpirationDateTime</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>now</span>()
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>distinct</span> <span style=color:#a6e22e>NetworkIP</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>AzureDiagnostics</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>Category</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;AzureFirewallNetworkRule&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>msg_s</span> <span style=color:#66d9ef>with</span> <span style=color:#f92672>*</span>  <span style=color:#e6db74>&#34; request from &#34;</span> <span style=color:#a6e22e>SourceIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>SourcePort</span> <span style=color:#e6db74>&#34; to &#34;</span> <span style=color:#a6e22e>DestIP</span> <span style=color:#e6db74>&#34;:&#34;</span> <span style=color:#a6e22e>DestPort</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>DestIP</span>  <span style=color:#66d9ef>in</span> (<span style=color:#a6e22e>maliciousIPs</span>)
</span></span></code></pre></div></p><p>è§£èª¬ :<br>ã“ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ Azure Sentinel ãŒå¿…è¦ã§ã™ã€‚Azure Sentinel ã§ã¯æ§˜ã€…ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ­ã‚°ã‚’é€£æºã™ã‚‹ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚³ãƒã‚¯ã‚¿ãŒã‚ã‚Šã€è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ï¼ˆä¿¡é ¼ã§ããªã„IPã€URLã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚·ãƒ¥ãªã©ï¼‰ã‚’å–ã‚Šè¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã®ä¾‹ã§ã¯è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ã‹ã‚‰å¾—ã‚‰ã‚ŒãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªä¿¡é ¼ã§ããªã„ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã«å¯¾ã—ã¦ Azure Firewall ã®ãƒ­ã‚°ã‚’ç…§ä¼šã—ã€ã‚ã‚„ã—ã„å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ãŒã‚ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚</p></details></div><h3 id=resource-graph>Resource Graph</h3><div><details><summary>View subscriptions with no Key Vaults</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>ResourceContainers</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>==</span><span style=color:#e6db74>&#39;microsoft.resources/subscriptions&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>id</span> <span style=color:#66d9ef>with</span> <span style=color:#e6db74>&#34;/subscriptions/&#34;</span> <span style=color:#a6e22e>SubscriptionID</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>subscriptionId</span>, <span style=color:#a6e22e>SubscriptionName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>leftouter</span> (
</span></span><span style=display:flex><span><span style=color:#a6e22e>Resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;microsoft.keyvault/vaults&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>id</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>subscriptionId</span>
</span></span><span style=display:flex><span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>subscriptionId</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span> <span style=color:#a6e22e>leftouter</span> (
</span></span><span style=display:flex><span><span style=color:#a6e22e>Resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;microsoft.keyvault/vaults&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>ResourceCount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>subscriptionId</span>
</span></span><span style=display:flex><span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>subscriptionId</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>RCount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iff</span>(<span style=color:#a6e22e>isnull</span>(<span style=color:#a6e22e>ResourceCount</span>), <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>ResourceCount</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span><span style=color:#f92672>-</span><span style=color:#a6e22e>away</span> <span style=color:#a6e22e>ResourceCount</span>, <span style=color:#a6e22e>subscriptionId1</span>, <span style=color:#a6e22e>subscriptionId2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>HealthStatus</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>iff</span>(<span style=color:#a6e22e>RCount</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>, <span style=color:#e6db74>&#34;Not Compliant&#34;</span>, <span style=color:#e6db74>&#34;Compliant&#34;</span>)
</span></span></code></pre></div></p><p>Description :<br>You can use this query in Azure Resource Graph to identify any subscriptions that do not contain KeyVaults.</p></details></div><div><details><summary>View status of Azure Monitor Agents for all virtual machines</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.compute/virtualmachines&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>ComputerName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>subscriptionId</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>leftouter</span>  (
</span></span><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.compute/virtualmachines/extensions&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#34;AzureMonitorLinuxAgent&#34;</span>, <span style=color:#e6db74>&#34;AzureMonitorWindowsAgent&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>id</span> <span style=color:#66d9ef>with</span> <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;/virtualMachines/&#34;</span> <span style=color:#a6e22e>ComputerName</span> <span style=color:#e6db74>&#34;/extensions/&#34;</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>AMAStatus</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>provisioningState</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>WorkspaceID</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>workspaceId</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>AMA</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>ComputerName</span>, <span style=color:#a6e22e>AMAStatus</span>
</span></span><span style=display:flex><span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>ComputerName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>leftouter</span>  (
</span></span><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.compute/virtualmachines/extensions&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#34;MicrosoftMonitoringAgent&#34;</span>, <span style=color:#e6db74>&#34;OmsAgentForLinux&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>parse</span> <span style=color:#a6e22e>id</span> <span style=color:#66d9ef>with</span> <span style=color:#f92672>*</span> <span style=color:#e6db74>&#34;/virtualMachines/&#34;</span> <span style=color:#a6e22e>ComputerName</span> <span style=color:#e6db74>&#34;/extensions/&#34;</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>MMAStatus</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>provisioningState</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>WorkspaceID</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>workspaceId</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>MMA</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>ComputerName</span>, <span style=color:#a6e22e>MMAStatus</span>, <span style=color:#a6e22e>WorkspaceID</span>
</span></span><span style=display:flex><span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>ComputerName</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>join</span> <span style=color:#a6e22e>kind</span><span style=color:#f92672>=</span><span style=color:#a6e22e>leftouter</span>  (
</span></span><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.operationalinsights/workspaces&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> <span style=color:#a6e22e>WorkspaceID</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>customerId</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>WorkspaceName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>WorkspaceID</span>
</span></span><span style=display:flex><span>) <span style=color:#a6e22e>on</span> <span style=color:#a6e22e>WorkspaceID</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span><span style=color:#f92672>-</span><span style=color:#a6e22e>away</span> <span style=color:#a6e22e>WorkspaceID1</span>, <span style=color:#a6e22e>ComputerName1</span>, <span style=color:#a6e22e>ComputerName2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>extend</span> [<span style=color:#e6db74>&#34;Both Agents&#34;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>iff</span>(<span style=color:#a6e22e>isnotempty</span>(<span style=color:#a6e22e>AMA</span>) <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>isnotempty</span>(<span style=color:#a6e22e>MMA</span>), <span style=color:#e6db74>&#34;True&#34;</span>, <span style=color:#e6db74>&#34;False&#34;</span>)
</span></span></code></pre></div></p><p>Description :<br>You can use this query in Azure Resource Graph to identify which virtual machines have both the Azure Monitor Agent and the Microsoft Monitoring Agent deployed, and which workspace the MMA reports to.</p></details></div><div><details><summary>View Orphan Managed disks</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>=~</span> <span style=color:#e6db74>&#39;microsoft.compute/Disks&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>managedBy</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>id</span>
</span></span></code></pre></div></p><p>Description :<br>You can use this query in Azure Resource Graph to identify any orphaned disks.</p></details></div><div><details><summary>View Orphaned NICs</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.network/networkinterfaces&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>isnull</span> (<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>virtualMachine</span>) <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>isnull</span> (<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>privateEndpoint</span>)
</span></span></code></pre></div></p><p>Description :<br>This query can be used in Azure Resource Graph to identify any detached NIC</p></details></div><div><details><summary>View Orphaned NSGs</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>=~</span> <span style=color:#e6db74>&#39;microsoft.network/networksecuritygroups&#39;</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>isnull</span>(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>networkInterfaces</span>) <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>isnull</span>(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>subnets</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>resourceGroup</span>
</span></span></code></pre></div></p><p>Description :<br>This query can be used in Azure Resource Graph to identify any used Network Security Group</p></details></div><div><details><summary>View Orphaned Route Tables</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.network/routetables&#34;</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>isnull</span>(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>subnets</span>)
</span></span></code></pre></div></p><p>Description :<br>This query can be used in Azure Resource Graph to identify any unused route table</p></details></div><div><details><summary>Show Storage accounts with public endpoints</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.storage/storageaccounts&#34;</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>allowBlobPublicAccess</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;true&#39;</span>
</span></span></code></pre></div></p><p>Description :<br>This query can be used in Azure Resource Graph to identify any storage account with public endpoints</p></details></div><div><details><summary>Show Storage accounts with non-encrypted transfers enabled</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>  <span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.storage/storageaccounts&#34;</span> <span style=color:#a6e22e>and</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>allowBlobPublicAccess</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;true&#39;</span>        
</span></span></code></pre></div></p><p>Description :<br>This query can be used in Azure Resource Graph to identify any storage accounts without an https requirement</p></details></div><div><details><summary>VNets: Peering Configuration</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> [<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;microsoft.network/virtualnetworks&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>mv</span><span style=color:#f92672>-</span><span style=color:#a6e22e>expand</span> <span style=color:#a6e22e>peerings</span><span style=color:#f92672>=</span><span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>virtualNetworkPeerings</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>VNetName</span><span style=color:#f92672>=</span><span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>peeringName</span><span style=color:#f92672>=</span><span style=color:#a6e22e>peerings</span>.<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>peeringTarget</span><span style=color:#f92672>=</span><span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>peerings</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>remoteVirtualNetwork</span>.<span style=color:#a6e22e>id</span>,<span style=color:#e6db74>&#34;/&#34;</span>,<span style=color:#ae81ff>8</span>)[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>peeringState</span><span style=color:#f92672>=</span><span style=color:#a6e22e>peerings</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>peeringState</span>,<span style=color:#a6e22e>useRemoteGateways</span><span style=color:#f92672>=</span><span style=color:#a6e22e>peerings</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>useRemoteGateways</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>allowGatewayTransit</span><span style=color:#f92672>=</span><span style=color:#a6e22e>peerings</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>allowGatewayTransit</span>
</span></span></code></pre></div></p><p>Description :<br>Use this query to review the peering configuration of all Virtual Networks in scope</p></details></div><div><details><summary>Subnet details (NSG/UDR)</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> [<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;microsoft.network/virtualnetworks&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//| project dynProperties=todynamic(properties)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>|</span> <span style=color:#a6e22e>mv</span><span style=color:#f92672>-</span><span style=color:#a6e22e>expand</span> <span style=color:#a6e22e>subnetNames</span><span style=color:#f92672>=</span><span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>subnets</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>VNetName</span><span style=color:#f92672>=</span><span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>Subnet</span><span style=color:#f92672>=</span><span style=color:#a6e22e>subnetNames</span>.<span style=color:#a6e22e>name</span>,<span style=color:#a6e22e>AddressPrefix</span><span style=color:#f92672>=</span><span style=color:#a6e22e>subnetNames</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>addressPrefix</span>,
</span></span><span style=display:flex><span><span style=color:#a6e22e>RouteTable</span><span style=color:#f92672>=</span><span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>subnetNames</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>routeTable</span>.<span style=color:#a6e22e>id</span>,<span style=color:#e6db74>&#34;/&#34;</span>,<span style=color:#ae81ff>8</span>)[<span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span><span style=color:#a6e22e>NSG</span><span style=color:#f92672>=</span><span style=color:#a6e22e>split</span>(<span style=color:#a6e22e>subnetNames</span>.<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>networkSecurityGroup</span>.<span style=color:#a6e22e>id</span>,<span style=color:#e6db74>&#34;/&#34;</span>,<span style=color:#ae81ff>8</span>)[<span style=color:#ae81ff>0</span>],<span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;microsoft.network/subnets&#34;</span>
</span></span></code></pre></div></p><p>Description :<br>This query shows details about the subnets, Addresses, NSGs, UDRs.</p></details></div><div><details><summary>Display count of VMs by Azure location</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Resources</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.compute/virtualmachines&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>Total</span><span style=color:#f92672>=</span><span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>Region</span><span style=color:#f92672>=</span><span style=color:#a6e22e>location</span>
</span></span></code></pre></div></p><p>Description :<br>Use this query to display a count of VMs by Azure location</p></details></div><div><details><summary>Display a count of VMs by OS Platform</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>resources</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> [<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;microsoft.compute/virtualmachines&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>osType</span><span style=color:#f92672>=</span><span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>storageProfile</span>.<span style=color:#a6e22e>osDisk</span>.<span style=color:#a6e22e>osType</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>summarize</span> <span style=color:#a6e22e>count</span>() <span style=color:#a6e22e>by</span> <span style=color:#a6e22e>tostring</span>(<span style=color:#a6e22e>osType</span>)
</span></span></code></pre></div></p><p>Description :<br>Use this query to display a count of VMs by OS Platform</p></details></div><div><details><summary>&lt;<em>ASG</em>> ã§æŒ‡å®šã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ã‚°ãƒ«ãƒ¼ãƒ—ã«ç´ã¥ããƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹</summary><p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Resources</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;microsoft.network/networkinterfaces&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>isnotnull</span> (<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>ipConfigurations</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>applicationSecurityGroups</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>subscriptionId</span>, <span style=color:#a6e22e>resourceGroup</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>ASGs</span><span style=color:#f92672>=</span><span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>ipConfigurations</span>[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>applicationSecurityGroups</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>mv</span><span style=color:#f92672>-</span><span style=color:#a6e22e>expand</span> <span style=color:#a6e22e>ASGs</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>project</span> <span style=color:#a6e22e>subscriptionId</span>, <span style=color:#a6e22e>resourceGroup</span>, <span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>ASG</span><span style=color:#f92672>=</span><span style=color:#a6e22e>ASGs</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span><span style=color:#f92672>|</span> <span style=color:#a6e22e>where</span> <span style=color:#a6e22e>ASG</span> <span style=color:#a6e22e>endswith</span> <span style=color:#e6db74>&#34;&lt;ASG&gt;&#34;</span>
</span></span></code></pre></div></p><p>Description :<br>NA</p></details></div><div class=section-index></div><div class="text-muted mt-5 pt-3 border-top">æœ€çµ‚æ›´æ–° June 13, 2022: <a href=https://github.com/tsubasaxZZZ/fta-hackon2022/commit/2a0a62fe3e1d45f1f066318a901412089b2e78b9>Copy from HackOn repository (2a0a62f)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tsubasaxZZZ/fta-hackon2022 aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/fta-hackon2022/js/tabpane-persist.js></script>
<script src=/fta-hackon2022/js/main.min.9dedb4cb1735665f9e5f74805a267db6a8e16f899c40f6135e9be8787b1b8d0d.js integrity="sha256-ne20yxc1Zl+eX3SAWiZ9tqjhb4mcQPYTXpvoeHsbjQ0=" crossorigin=anonymous></script></body></html>